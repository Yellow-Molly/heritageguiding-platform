# Phase 02: Config & Packages Rebrand

## Context Links
- [Plan Overview](./plan.md)
- [Phase 01: Source Code](./phase-01-source-code-rebrand.md)

## Overview
- **Date:** 2026-02-17
- **Description:** Rename package scopes, update Payload config, regenerate lock file
- **Priority:** P1
- **Status:** Pending
- **Review Status:** Not started

## Key Insights
- Package scope `@heritageguiding` used in root package.json, apps/web/package.json, packages/cms/package.json
- `package-lock.json` will be auto-regenerated by `npm install` after name changes
- Payload CMS admin panel title suffix references brand
- Environment variable `NEXT_PUBLIC_URL` is set at deploy-time (not in source), but documented in .env.example and README

## Requirements

### Functional
- All package names use `@privatetours` scope
- Payload admin panel shows "PrivateTours" branding
- `npm install` succeeds after renames

### Non-Functional
- Lock file regenerated cleanly
- No circular dependency issues from rename

## Architecture
Package scope rename is cosmetic (monorepo uses workspace resolution, not registry). Cross-package imports use workspace protocol, so renaming is safe.

## Related Code Files

1. `package.json` (root) -- workspace name
2. `apps/web/package.json` -- `@heritageguiding/web`
3. `packages/cms/package.json` -- `@heritageguiding/cms`
4. `package-lock.json` -- auto-generated, will regenerate
5. `packages/cms/payload.config.ts` -- `titleSuffix: "- HeritageGuiding"`
6. `apps/web/next.config.ts` -- may reference domain for redirects/rewrites

## Implementation Steps

### Step 1: Root package.json
- Find: `"name": "heritageguiding-platform"` -> Replace: `"name": "privatetours-platform"`

### Step 2: apps/web/package.json
- Find: `"name": "@heritageguiding/web"` -> Replace: `"name": "@privatetours/web"`
- Check dependencies referencing `@heritageguiding/cms` -> Replace: `@privatetours/cms`

### Step 3: packages/cms/package.json
- Find: `"name": "@heritageguiding/cms"` -> Replace: `"name": "@privatetours/cms"`

### Step 4: Check other package.json files
- `packages/ui/package.json` -- check if it has `@heritageguiding` scope
- `packages/types/package.json` -- check if it has `@heritageguiding` scope

### Step 5: Payload Config
In `packages/cms/payload.config.ts`:
- Find: `"- HeritageGuiding"` -> Replace: `"- PrivateTours"`

### Step 6: next.config.ts
In `apps/web/next.config.ts`:
- Check for any domain references (allowed images, redirects, etc.)
- Find: `heritageguiding.com` -> Replace: `privatetours.se` (if present)

### Step 7: Regenerate Lock File
```bash
rm package-lock.json
npm install
```

### Step 8: Verify
```bash
npm run lint
npm run type-check
npm run build
```

## Todo List
- [ ] Update root package.json name
- [ ] Update apps/web/package.json name and deps
- [ ] Update packages/cms/package.json name
- [ ] Check packages/ui and packages/types package.json files
- [ ] Update Payload config titleSuffix
- [ ] Check next.config.ts for domain references
- [ ] Delete package-lock.json and run npm install
- [ ] Verify build passes

## Success Criteria
- `grep -r "@heritageguiding" package*.json apps/*/package.json packages/*/package.json` returns nothing
- `npm install` completes without errors
- `npm run build` passes
- Payload admin panel title shows "PrivateTours"

## Risk Assessment
- **Medium risk:** Package rename + lock file regeneration could surface dependency resolution issues
- **Mitigation:** Keep old package-lock.json as backup; if `npm install` fails, debug workspace resolution
- **Watch for:** Cross-package references in tsconfig paths or other config files

## Security Considerations
- No secrets involved in this phase
- Verify no `.env` files are accidentally committed during lock file regeneration

## Next Steps
- Proceed to Phase 03 (i18n) in parallel
- Lock file must be committed with package.json changes
